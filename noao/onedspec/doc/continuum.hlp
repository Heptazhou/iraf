.help continuum Oct85 noao.onedspec
.ih
NAME
continuum -- Fit the continuum of spectra
.ih
USAGE	
continuum input output
.ih
PARAMETERS
.ls input
Input spectra in which the continuum is to be fit.
.le
.ls output
Output spectra.  The number of output spectra must match the number of input
spectra.  By default the output spectrum is the continuum normalized
input spectrum.
.le
.ls type = "ratio"
Type of output spectra.  The choices are "ratio" for the ratio of the input
spectra to the fitted continuum, "fit" for the fitted continuum spectrum,
and "difference" for the difference between the input spectra and the fitted
continuum spectrum.  The default "ratio" corresponds to the continuum
normalized spectra.
.le
.ls axis = 1
Dispersion axis along which the continuum fitting is done.
.le
.ls sample = "*"
Lines or columns to be used in the fits.
.le
.ls naverage = 1
Number of sample points to combined to create a fitting point.
A positive value specifies an average and a negative value specifies
a median.
.le
.ls function = spline3
Continuum function to be fit to the image lines or columns.  The functions are
"legendre" (legendre polynomial), "chebyshev" (chebyshev polynomial),
"spline1" (linear spline), and "spline3" (cubic spline).  The functions
may be abbreviated.
.le
.ls order = 1
The order of the polynomials or the number of spline pieces.
.le
.ls low_reject = 2., high_reject = 0.
Rejection limits below and above the fit in units of the residual sigma.
.le
.ls niterate = 10
Number of rejection iterations.
.le
.ls grow = 1.
When a pixel is rejected, pixels within this distance of the rejected pixel
are also rejected.
.le
.ls graphics = "stdgraph"
Graphics output device for interactive graphics.
.le
.ls cursor = ""
Graphics cursor input.
.le
.ih
DESCRIPTION
A one dimensional function is fit to the continuum along the dispersion axis.
The function may be a legendre polynomial, chebyshev polynomial,
linear spline, or cubic spline of a given order or number of spline pieces.
The output image is of pixel type real.  The default output spectrum is formed
from the ratio between the pixel values and the fitted continuum.
Additional output types are the fitted continuum and the continuum subtracted
spectrum.  This task is a simple script based on the task \fBimages.fit1d\fR.

The continuum points fit are determined by selecting a sample of lines or
columns specified by the parameter \fIsample\fR and taking either the average or
median of the number of points specified by the parameter \fInaverage\fR.
The type of averaging is selected by the sign of the parameter and the number
of points is selected by the absolute value of the parameter.
The sample points are specified relative to any image sections.

If \fIlow_reject\fR and/or \fIhigh_reject\fR are greater than zero the sigma
of the residuals between the fitted points and the fitted function is computed
and those points whose residuals are less than \fI-low_reject\fR * sigma
and greater than \fIhigh_reject\fR * sigma are excluded from the fit.
Points within a distance of \fIgrow\fR pixels of a rejected pixel are also
excluded from the fit.  The function is then refit without the rejected points.
This rejection procedure may be iterated a number of times given by the
parameter \fIniterate\fR.

The fitting parameters (\fIsample, naverage, function, order, low_reject,
high_reject, niterate, grow\fR)
may be adjusted interactively if the parameter \fIinteractive\fR is yes.
Lines or columns from the image are selected to be fit with the \fBicfit\fR
package.  The cursor mode commands for this package are described in a
separate help entry under "icfit".  Line 1 is automatically selected for
one dimensional images and any number of lines or columns may be selected
for two dimensional images.  Note that the lines or columns are relative
the input image section; for example line 1 is the first line of the image
section and not the first line of the image.  When an end-of-file or no line
or column is given then the last selected fitting parameters are used on
each line or column of the image.  This step is repeated for
each image in the input list.
.ih
EXAMPLES
1.  To normalize the spectrum for hd221170

	cl> continuum hd221170 hd221170.1

The spectrum is graphed and the interactive options for setting and
fitting the continuum are used.  The important parameters are low_rejection,
the function type, and the order of the function type.  Exiting with 'q' or
return creates the output, continuum normalized spectrum.

2.  To do several images at the same time

	cl> continuum spec* spec*//.1

3.  With two dimensional images the user is prompted for the image line
or column to use in establishing the continuum fit parameters.  By responding
with carriage return to the prompt all the lines or columns of the image
will be fit and the continuum normalized image is produced.

4. If several images are specified the user is prompt whether to adjust the
fitting parameters interactively to which the response may be no, yes, NO,
YES.  The uppercase response permanently answer the queries resulting in
no further queries of this type.
.ih
WARNING
If the data being fitted passes near or through zero then the ratio may
produce very large values.  One can either add a constant to the spectrum
or replace the bad values in the input or output spectrum.
.ih
SEE ALSO
fit1d, icfit
.endhelp
