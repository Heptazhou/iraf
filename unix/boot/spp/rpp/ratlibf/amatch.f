      INTEGER FUNCTION AMATCH (LIN, FROM, PAT, TAGBEG, TAGEND)
      INTEGER LIN (128), PAT (128)
      INTEGER FROM, TAGBEG (10), TAGEND (10)
      INTEGER I, J, OFFSET, STACK
      INTEGER OMATCH, PATSIZ
      I = 1
23000 IF (.NOT.(I .LE. 10))GOTO 23002
      TAGBEG (I) = 0
      TAGEND (I) = 0
23001 I = I + 1
      GOTO 23000
23002 CONTINUE
      TAGBEG (1) = FROM
      STACK = 0
      OFFSET = FROM
      J = 1
23003 IF (.NOT.(PAT (J) .NE. -2))GOTO 23005
      IF (.NOT.(PAT (J) .EQ. 42))GOTO 23006
      STACK = J
      J = J + 4
      I = OFFSET
23008 IF (.NOT.(LIN (I) .NE. -2))GOTO 23010
      IF (.NOT.(OMATCH (LIN, I, PAT, J) .EQ. 0))GOTO 23011
      GOTO 23010
23011 CONTINUE
23009 GOTO 23008
23010 CONTINUE
      PAT (STACK + 1) = I - OFFSET
      PAT (STACK + 3) = OFFSET
      OFFSET = I
      GOTO 23007
23006 CONTINUE
      IF (.NOT.(PAT (J) .EQ. 123))GOTO 23013
      I = PAT (J + 1)
      TAGBEG (I + 1) = OFFSET
      GOTO 23014
23013 CONTINUE
      IF (.NOT.(PAT (J) .EQ. 125))GOTO 23015
      I = PAT (J + 1)
      TAGEND (I + 1) = OFFSET
      GOTO 23016
23015 CONTINUE
      IF (.NOT.(OMATCH (LIN, OFFSET, PAT, J) .EQ. 0))GOTO 23017
23019 IF (.NOT.(STACK .GT. 0))GOTO 23021
      IF (.NOT.(PAT (STACK + 1) .GT. 0))GOTO 23022
      GOTO 23021
23022 CONTINUE
23020 STACK = PAT (STACK + 2)
      GOTO 23019
23021 CONTINUE
      IF (.NOT.(STACK .LE. 0))GOTO 23024
      AMATCH = 0
      RETURN
23024 CONTINUE
      PAT (STACK + 1) = PAT (STACK + 1) - 1
      J = STACK + 4
      OFFSET = PAT (STACK + 3) + PAT (STACK + 1)
23017 CONTINUE
23016 CONTINUE
23014 CONTINUE
23007 CONTINUE
23004 J = J + PATSIZ (PAT, J)
      GOTO 23003
23005 CONTINUE
      AMATCH = OFFSET
      TAGEND (1) = OFFSET
      RETURN
      END
